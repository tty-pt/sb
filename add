#!/bin/sh
chords_path=$DOCUMENT_ROOT/items/chords/items
choirs_path=$DOCUMENT_ROOT/items/choir/items

if test "$REQUEST_METHOD" = "POST"; then
	choir="`fd choir`"
	choir_path="$choirs_path/$choir"
	math "`cat $choir_path/counter`" + 1 > $choir_path/counter
	echo $choir > choir

	choir_format="`test -f $choir_path/format && echo $choir_path/format || echo $choirs_path/../../sb/format`"

	cat $choir_format | while read line; do
		echo :0:$line
	done > data.txt
else
	path="$chords_path/$song"
	echo "<label class='f h'>Choir: "
	echo "<select name='choir'>"
	qmap -l $choirs_path/index.db | while read link flags title; do
		test "$link" = "$HTTP_PARAM_choir" && \
			attr="selected" || attr=""
		echo "<option $attr value='$link'>$title</option>"
	done
	echo "</select>"
	echo "</label>"
fi
